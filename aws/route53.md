# Route53について

## 概要
Route53は信頼性が高く、費用効率に優れた方法でエンドユーザーに対してインターネットアプリケーションにルーティングできるWebサービス。<br />
オンプレミスの場合、DNSサーバを構築し、DNSサーバ自体の運用も必要となるが、Amazon Route53ではAWSマネジメントコンソールから簡単に操作・管理が行える。<br />

## 機能
以下3つの機能がある。

### ドメイン登録機能
ドメイン名をAmazon Route53に登録することで、ドメインの運用・管理が可能となる。<br />


### DNSルーティング機能
ウェブサイトにアクセスするにはブラウザのアドレスバーにドメイン名"sunnycloud.jp（例）"またはサブドメイン名"www.sunnycloud.jp"を入力することで、Route53がブラウザに対してアクセスしたドメインに紐づく情報の受け渡しを行い、ウェブサイトの表示、またはウェブアプリケーションに接続するための支援を行う。<br />


### DNSヘルスチェック機能
DNSヘルスチェック機能では、ウェブサーバなどのリソースの正常性を監視することができる。<br />
必要に応じてヘルスチェックに失敗した際に、CloudWatchアラームの通知を受ける設定も可能。<br />
この機能により、DNSエンドポイントのリソースが日正常な状態であることにきっづくこともRoute53でできるため、何か問題があった際のダウンタイムを削減することが可能になる。<br />


## ドメインの登録について
新しく取得したいドメイン名をRoute53上で管理するドメインとして登録することが可能・<br />

例えば、他のレジストラ上で管理するドメインですでに管理しているドメインでも、基本的にはRoute53に移管することが可能。<br />


Route53に登録できるドメインでは"登録または移管ができない制約"があるため、登録前または移管前には、[公式ドキュメント](https://docs.aws.amazon.com/ja_jp/Route53/latest/DeveloperGuide/registrar-tld-list.html)を参照することが重要。<br />

なお、一度ドメイン名を登録した後はドメイン名を事後変更することはできない。<br />


## 登録できるDNSレコードタイプについて
Route53で登録できるDNSレコードは下記タイプが可能。<br />


- A レコードタイプ
- AAAA レコードタイプ
- CAA レコードタイプ
- CNAME レコードタイプ
- DS レコードタイプ
- MX レコードタイプ
- NAPTR レコードタイプ
- NS レコードタイプ
- PTR レコードタイプ
- SOA レコードタイプ
- SPF レコードタイプ
- SRV レコードタイプ
- TXT レコードタイプ

特にRoute53の"エイリアスレコード"と呼ばれるDNS機能は非常に便利で、例えばすでにS3のリソースがRoute53と同じAWSアカウントに存在する場合、CNAMEレコードの値としてAWSリソース（S3バケットなど）を設定することが可能。<br />


## ルーティングポリシーについて

Route53で一般的によく利用されるルーティングポリシーは以下のとおり。<br />


### シンプルルーティング
基本的なルーティング設定。標準のDNSレコードを設定でき、例えば"sunnycloud.jp"のウェブサイトに対し特定のIPアドレスを設定することが可能。<br />
なお、同一レコードに複数の値（複数のIPアドレス）を指定することが可能。<br />


### フェイルオーバールーティング

プライマリレコードとセンダリレコードでトラフィックのルーティングを振り分けることができる。<br />
クエリとしてRoute53がルーティングするのは正常なプライマリリソースのみである。<br />
すべてのプライマリリソースにて以上が発生した場合はDNSクエリの応答として正常なセカンダリリソースのみにルーティングする。<br />


### 位置情報ルーティング
ユーザーの物理的な場所に対して、トラフィックをルーティングすることができる。<br  />
例えばシンガポールからのリクエストをシンガポールリージョンのリソース（S3やALBロードバランサーなど）に振り分けることが可能。<br />
具体的にはIPアドレスを位置情報にマッピングすることによって動作する。<br />
特にグローバルでワールドワイドなビジネス展開をする場合に適している。<br />


### レイテンシーに基づくルーティング
複数のリージョンにビジネス展開している場合、ネットワークレイテンシーが最も低いAWSリソース（リージョン）に対してルーティングすることによって、より低いレイテンシーでサービスを提供することが可能。<br />


### 加重ルーティング
単一のドメイン名、例えば"sunnycloud.jp"、または単一サブドメイン"www.sunnycloud.jp"に対して複数のリソースを設定可能。<br />
用途として、負荷分散以外にソフトウェアのバージョン別に振り分けテストを行う、またはABテストなどで利用される。<br />
例えば、重みづけの設定として、Aというルーティングは"1"、Bというルーティングは"2"などで振り分けすることが可能。<br />

## ホストゾーンについて

ホストゾーンとは、ドメイン及びサブドメインのトラフィックをルーティングする方法に関する情報を保持するコンテナを指す。<br />

ホストゾーンには以下2種類がある。<br />

### パブリックホストゾーン

パブリックホストゾーンには、インターネット上でどのようにルーティングするかを指定するDNSレコードが含まれる。<br />


### プライベートホストゾーン

プライベートホストゾーンには、Amazon VPC内でどのようにルーティングするかを指定するDNSレコードが含まれる。<br />


[![Image from Gyazo](https://i.gyazo.com/79063bad6802bb0cd0c23c807ab54c0c.png)](https://gyazo.com/79063bad6802bb0cd0c23c807ab54c0c)<br />


パブリックホストゾーンはインターネット上におけるDNSルーティングを行うため、一般的によく利用される。<br />
一方でセキュリティ要件が高く、インターネットの外向けへの制限があるビジネスで、Amazon VPC内部ネットワーク内でDNSルーティングを行いたいユースケースもある。<br />
その場合は、プライベートホストゾーンでドメイン登録することで達成することが可能。<br />


## ホストゾーンとレコード用のドメイン名の形式
ホストゾーンおよびレコードの場合、ドメイン名にはスペースを除くASCII文字を使用することが可能。<br />

```
a～z
0-9
-(ハイフン)
! ” # $ % & ‘ ( ) * + , – / : ; < = > ? @ [ \ ] ^ _ ` { | } ~ .
```
大文字または小文字、あるいはエスケープコードで対応する文字を指定するかに関係なく、Route53は英小文字（a~z）としてデータに格納する。<br />


## ドメイン移管について
他のレジストラですでに管理しているドメインをAmazon Route53にドメイン移管することも可能。<br />
ただし、移管手順としては慎重に行う必要があるため、[公式ドキュメント](https://docs.aws.amazon.com/ja_jp/Route53/latest/DeveloperGuide/domain-transfer-to-route-53.html)を参照しながら作業することが大事らしい。<br />



## 参考文献
[Sunny Cloud](https://www.sunnycloud.jp/column/20210602-01/)
